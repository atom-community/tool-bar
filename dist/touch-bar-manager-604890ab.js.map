{"version":3,"file":"touch-bar-manager-604890ab.js","sources":["../src/touch-bar-manager.js"],"sourcesContent":["import {remote} from 'electron';\r\nconst {TouchBar, nativeImage} = remote;\r\nconst {TouchBarButton} = TouchBar;\r\n\r\nexport class TouchBarManager {\r\n  constructor () {\r\n    this.buttons = [];\r\n  }\r\n\r\n  destroy () {\r\n    this.buttons = [];\r\n    this.update();\r\n  }\r\n\r\n  addButton (button) {\r\n    if (this.buttons.length >= 7) return;\r\n\r\n    this._renderButton(button).then(icon => {\r\n      const touchButton = new TouchBarButton({\r\n        icon: icon,\r\n        click: button._onClick.bind(button, {})\r\n      });\r\n\r\n      this.buttons.push({\r\n        priority: button.priority ? button.priority : 0,\r\n        touchButton,\r\n        group: button.group\r\n      });\r\n\r\n      this.update();\r\n    });\r\n  }\r\n\r\n  update () {\r\n    if (this._updateDebounce) clearTimeout(this._updateDebounce);\r\n    this._updateDebounce = setTimeout(() => this._setTouchBar(), 100);\r\n  }\r\n\r\n  removeGroup (group) {\r\n    this.buttons = this.buttons.filter(button => button.group !== group);\r\n    this.update();\r\n  }\r\n  \r\n  _renderButton (button) {\r\n    return document.fonts.ready.then(() => {\r\n      if (!(button.element instanceof HTMLElement)) return;\r\n\r\n      const iconSize = 44 * 2;\r\n      const iconStyle = window.getComputedStyle(button.element, ':before');\r\n      const iconText = iconStyle.content.replace(/[\"']/g, '');\r\n\r\n      let canvas = document.createElement('canvas');\r\n      canvas.width = 60 * 2;\r\n      canvas.height = 60 * 2;\r\n      let context = canvas.getContext('2d');\r\n      context.textAlign = 'center';\r\n      context.textBaseline = 'top';\r\n\r\n      context.fillStyle = button.enabled ? '#fff' : '#aaa';\r\n      context.font = `${iconSize}px ${iconStyle.fontFamily}`;\r\n      context.fillText(iconText, canvas.width / 2, (canvas.height - iconSize) / 2);\r\n\r\n      const image = nativeImage.createEmpty();\r\n      image.addRepresentation({\r\n        dataURL: canvas.toDataURL(),\r\n        scaleFactor: 2.0,\r\n        width: 44,\r\n        height: 44\r\n      });\r\n\r\n      return image;\r\n    });\r\n  }\r\n\r\n  _setTouchBar () {\r\n    const items = this.buttons\r\n      .sort((a, b) => a.priority - b.priority)\r\n      .map(button => button.touchButton);\r\n    let touchBar = new TouchBar({items});\r\n    atom.getCurrentWindow().setTouchBar(touchBar);\r\n    this._updateDebounce = null;\r\n  }\r\n}\r\n"],"names":["TouchBar","nativeImage","remote","TouchBarButton","constructor","buttons","destroy","update","addButton","button","this","length","_renderButton","then","icon","touchButton","click","_onClick","bind","push","priority","group","_updateDebounce","clearTimeout","setTimeout","_setTouchBar","removeGroup","filter","document","fonts","ready","element","HTMLElement","iconStyle","window","getComputedStyle","iconText","content","replace","canvas","createElement","width","height","context","getContext","textAlign","textBaseline","fillStyle","enabled","font","fontFamily","fillText","image","createEmpty","addRepresentation","dataURL","toDataURL","scaleFactor","items","sort","a","b","map","touchBar","atom","getCurrentWindow","setTouchBar"],"mappings":"uCACA,MAAMA,SAACA,EAADC,YAAWA,GAAeC,UAC1BC,eAACA,GAAkBH,0BAElB,MACLI,mBACOC,QAAU,GAGjBC,eACOD,QAAU,QACVE,SAGPC,UAAWC,GACLC,KAAKL,QAAQM,QAAU,QAEtBC,cAAcH,GAAQI,KAAKC,UACxBC,EAAc,IAAIZ,EAAe,CACrCW,KAAMA,EACNE,MAAOP,EAAOQ,SAASC,KAAKT,EAAQ,WAGjCJ,QAAQc,KAAK,CAChBC,SAAUX,EAAOW,SAAWX,EAAOW,SAAW,EAC9CL,YAAAA,EACAM,MAAOZ,EAAOY,aAGXd,WAITA,SACMG,KAAKY,iBAAiBC,aAAab,KAAKY,sBACvCA,gBAAkBE,WAAW,IAAMd,KAAKe,eAAgB,KAG/DC,YAAaL,QACNhB,QAAUK,KAAKL,QAAQsB,OAAOlB,GAAUA,EAAOY,QAAUA,QACzDd,SAGPK,cAAeH,UACNmB,SAASC,MAAMC,MAAMjB,KAAK,UACzBJ,EAAOsB,mBAAmBC,aAAc,aAGxCC,EAAYC,OAAOC,iBAAiB1B,EAAOsB,QAAS,WACpDK,EAAWH,EAAUI,QAAQC,QAAQ,QAAS,QAEhDC,EAASX,SAASY,cAAc,UACpCD,EAAOE,MAAQ,IACfF,EAAOG,OAAS,QACZC,EAAUJ,EAAOK,WAAW,MAChCD,EAAQE,UAAY,SACpBF,EAAQG,aAAe,MAEvBH,EAAQI,UAAYtC,EAAOuC,QAAU,OAAS,OAC9CL,EAAQM,KAAQ,QAAgBhB,EAAUiB,WAC1CP,EAAQQ,SAASf,EAAUG,EAAOE,MAAQ,GAAIF,EAAOG,OAbpC,IAayD,SAEpEU,EAAQnD,EAAYoD,qBAC1BD,EAAME,kBAAkB,CACtBC,QAAShB,EAAOiB,YAChBC,YAAa,EACbhB,MAAO,GACPC,OAAQ,KAGHU,IAIX3B,qBACQiC,EAAQhD,KAAKL,QAChBsD,KAAK,CAACC,EAAGC,IAAMD,EAAExC,SAAWyC,EAAEzC,UAC9B0C,IAAIrD,GAAUA,EAAOM,iBACpBgD,EAAW,IAAI/D,EAAS,CAAC0D,MAAAA,IAC7BM,KAAKC,mBAAmBC,YAAYH,QAC/BzC,gBAAkB"}