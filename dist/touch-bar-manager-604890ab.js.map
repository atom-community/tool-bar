{"version":3,"file":"touch-bar-manager-604890ab.js","sources":["../src/touch-bar-manager.js"],"sourcesContent":["import {remote} from 'electron';\nconst {TouchBar, nativeImage} = remote;\nconst {TouchBarButton} = TouchBar;\n\nexport class TouchBarManager {\n  constructor () {\n    this.buttons = [];\n  }\n\n  destroy () {\n    this.buttons = [];\n    this.update();\n  }\n\n  addButton (button) {\n    if (this.buttons.length >= 7) return;\n\n    this._renderButton(button).then(icon => {\n      const touchButton = new TouchBarButton({\n        icon: icon,\n        click: button._onClick.bind(button, {})\n      });\n\n      this.buttons.push({\n        priority: button.priority ? button.priority : 0,\n        touchButton,\n        group: button.group\n      });\n\n      this.update();\n    });\n  }\n\n  update () {\n    if (this._updateDebounce) clearTimeout(this._updateDebounce);\n    this._updateDebounce = setTimeout(() => this._setTouchBar(), 100);\n  }\n\n  removeGroup (group) {\n    this.buttons = this.buttons.filter(button => button.group !== group);\n    this.update();\n  }\n  \n  _renderButton (button) {\n    return document.fonts.ready.then(() => {\n      if (!(button.element instanceof HTMLElement)) return;\n\n      const iconSize = 44 * 2;\n      const iconStyle = window.getComputedStyle(button.element, ':before');\n      const iconText = iconStyle.content.replace(/[\"']/g, '');\n\n      let canvas = document.createElement('canvas');\n      canvas.width = 60 * 2;\n      canvas.height = 60 * 2;\n      let context = canvas.getContext('2d');\n      context.textAlign = 'center';\n      context.textBaseline = 'top';\n\n      context.fillStyle = button.enabled ? '#fff' : '#aaa';\n      context.font = `${iconSize}px ${iconStyle.fontFamily}`;\n      context.fillText(iconText, canvas.width / 2, (canvas.height - iconSize) / 2);\n\n      const image = nativeImage.createEmpty();\n      image.addRepresentation({\n        dataURL: canvas.toDataURL(),\n        scaleFactor: 2.0,\n        width: 44,\n        height: 44\n      });\n\n      return image;\n    });\n  }\n\n  _setTouchBar () {\n    const items = this.buttons\n      .sort((a, b) => a.priority - b.priority)\n      .map(button => button.touchButton);\n    let touchBar = new TouchBar({items});\n    atom.getCurrentWindow().setTouchBar(touchBar);\n    this._updateDebounce = null;\n  }\n}\n"],"names":["TouchBar","nativeImage","remote","TouchBarButton","constructor","buttons","destroy","update","addButton","button","this","length","_renderButton","then","icon","touchButton","click","_onClick","bind","push","priority","group","_updateDebounce","clearTimeout","setTimeout","_setTouchBar","removeGroup","filter","document","fonts","ready","element","HTMLElement","iconStyle","window","getComputedStyle","iconText","content","replace","canvas","createElement","width","height","context","getContext","textAlign","textBaseline","fillStyle","enabled","font","fontFamily","fillText","image","createEmpty","addRepresentation","dataURL","toDataURL","scaleFactor","items","sort","a","b","map","touchBar","atom","getCurrentWindow","setTouchBar"],"mappings":"uCACA,MAAMA,SAACA,EAADC,YAAWA,GAAeC,UAC1BC,eAACA,GAAkBH,0BAElB,MACLI,mBACOC,QAAU,GAGjBC,eACOD,QAAU,QACVE,SAGPC,UAAWC,GACLC,KAAKL,QAAQM,QAAU,QAEtBC,cAAcH,GAAQI,KAAKC,UACxBC,EAAc,IAAIZ,EAAe,CACrCW,KAAMA,EACNE,MAAOP,EAAOQ,SAASC,KAAKT,EAAQ,WAGjCJ,QAAQc,KAAK,CAChBC,SAAUX,EAAOW,SAAWX,EAAOW,SAAW,EAC9CL,YAAAA,EACAM,MAAOZ,EAAOY,aAGXd,WAITA,SACMG,KAAKY,iBAAiBC,aAAab,KAAKY,sBACvCA,gBAAkBE,WAAW,IAAMd,KAAKe,eAAgB,KAG/DC,YAAaL,QACNhB,QAAUK,KAAKL,QAAQsB,OAAOlB,GAAUA,EAAOY,QAAUA,QACzDd,SAGPK,cAAeH,UACNmB,SAASC,MAAMC,MAAMjB,KAAK,UACzBJ,EAAOsB,mBAAmBC,aAAc,aAGxCC,EAAYC,OAAOC,iBAAiB1B,EAAOsB,QAAS,WACpDK,EAAWH,EAAUI,QAAQC,QAAQ,QAAS,QAEhDC,EAASX,SAASY,cAAc,UACpCD,EAAOE,MAAQ,IACfF,EAAOG,OAAS,QACZC,EAAUJ,EAAOK,WAAW,MAChCD,EAAQE,UAAY,SACpBF,EAAQG,aAAe,MAEvBH,EAAQI,UAAYtC,EAAOuC,QAAU,OAAS,OAC9CL,EAAQM,KAAQ,QAAgBhB,EAAUiB,WAC1CP,EAAQQ,SAASf,EAAUG,EAAOE,MAAQ,GAAIF,EAAOG,OAbpC,IAayD,SAEpEU,EAAQnD,EAAYoD,qBAC1BD,EAAME,kBAAkB,CACtBC,QAAShB,EAAOiB,YAChBC,YAAa,EACbhB,MAAO,GACPC,OAAQ,KAGHU,IAIX3B,qBACQiC,EAAQhD,KAAKL,QAChBsD,KAAK,CAACC,EAAGC,IAAMD,EAAExC,SAAWyC,EAAEzC,UAC9B0C,IAAIrD,GAAUA,EAAOM,iBACpBgD,EAAW,IAAI/D,EAAS,CAAC0D,MAAAA,IAC7BM,KAAKC,mBAAmBC,YAAYH,QAC/BzC,gBAAkB"}