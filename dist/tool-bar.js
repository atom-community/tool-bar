"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("atom");class e{constructor(t,e){this.element=t.element,this.priority=t.priority,this.group=e}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null}}class o extends e{constructor(e,o){super({element:document.createElement("button"),priority:e.priority},o),this.subscriptions=new t.CompositeDisposable,this.options=e,this.enabled=!0,this.classNames=["btn","btn-default","tool-bar-btn"],this.priority<0&&this.putAtEnd(),this.addIcon(),this.addText(),this.addTooltip(),this.setStyle("color",e.color),this.setStyle("background",e.background),this.addClasses(),this.addOnMouseDown(),this.addOnClick()}destroy(){this.subscriptions.dispose(),this.element.removeEventListener("mousedown",this._onMouseDown),this.element.removeEventListener("click",this._onClick),super.destroy()}putAtEnd(){this.classNames.push("tool-bar-item-align-end")}addIcon(){this.options.icon&&(this.options.iconset?this.options.iconset.startsWith("fa")?this.classNames.push(this.options.iconset,"fa-"+this.options.icon):this.classNames.push(this.options.iconset,`${this.options.iconset}-${this.options.icon}`):this.classNames.push("icon-"+this.options.icon))}addText(){this.options.text&&(this.options.html?this.element.innerHTML=this.options.text:this.element.textContent=this.options.text)}addTooltip(){if(!this.options.tooltip)return;let t;t="string"==typeof this.options.tooltip?{title:this.options.tooltip}:this.options.tooltip,t.hasOwnProperty("placement")||(t.placement=function(){const t=atom.config.get("tool-bar.position");return{Top:"bottom",Right:"left",Bottom:"top",Left:"right"}[t]||null}()),t.hasOwnProperty("keyBindingCommand")||"string"!=typeof this.options.callback||(t.keyBindingCommand=this.options.callback),this.subscriptions.add(atom.tooltips.add(this.element,t))}setStyle(t,e){e&&(this.element.style[t]=e)}addClasses(){this.options.class&&(Array.isArray(this.options.class)?this.classNames.push(...this.options.class):this.element.classList.add(this.options.class)),this.element.classList.add(...this.classNames)}setEnabled(t){this.element.classList.toggle("disabled",!t),this.enabled=t}setSelected(t){this.element.classList.toggle("selected",t)}getSelected(){return this.element.classList.contains("selected")}addOnMouseDown(){this._onMouseDown=this._onMouseDown.bind(this),this.element.addEventListener("mousedown",this._onMouseDown)}_onMouseDown(t){t.preventDefault()}addOnClick(){this._onClick=this._onClick.bind(this),this.element.addEventListener("click",this._onClick)}_onClick(t){this.element&&!this.element.classList.contains("disabled")&&this.executeCallback(t),t.preventDefault&&(t.preventDefault(),t.stopPropagation())}executeCallback(t){let{callback:e,data:o}=this.options;"object"==typeof e&&!Array.isArray(e)&&e&&(e=function(t,{altKey:e,ctrlKey:o,shiftKey:s}){if(!(o||e||s))return t[""];const n=Object.keys(t).filter(Boolean).map(t=>t.toLowerCase()).reverse().find(t=>i(t.indexOf("alt"),e)&&i(t.indexOf("ctrl"),o)&&i(t.indexOf("shift"),s));return t[n]||t[""]}(e,t));const s=atom.views.getView(atom.workspace),n=s.contains(document.activeElement)?document.activeElement:s;Array.isArray(e)||(e=[e]);for(let t=0;t<e.length;t++)"string"==typeof e[t]?atom.commands.dispatch(n,e[t]):"function"==typeof e[t]&&e[t].call(this,o,n)}}function i(t,e){return!(~t&&!e||e&&!~t)}class s extends e{constructor(t,e){super({element:document.createElement("hr"),priority:t&&t.priority},e);const o=["tool-bar-spacer"];this.priority<0&&o.push("tool-bar-item-align-end"),this.element.classList.add(...o)}}class n{constructor(t,e,o){this.group=t,this.toolBarView=e,this.touchBarManager=o}addItem(t){const o=new e(t,this.group);return this.toolBarView.addItem(o),o}addButton(t){var e;const i=new o(t,this.group);return this.toolBarView.addItem(i),null===(e=this.touchBarManager)||void 0===e||e.addButton(i),i}addSpacer(t){const e=new s(t,this.group);return this.toolBarView.addItem(e),e}removeItems(){var t;this.toolBarView.items&&(this.toolBarView.items.filter(t=>t.group===this.group).forEach(t=>this.toolBarView.removeItem(t)),null===(t=this.touchBarManager)||void 0===t||t.removeGroup(this.group))}onDidDestroy(t){this.toolBarView.emitter.on("did-destroy",t)}}class r{constructor(){this.element=document.createElement("div"),this.element.classList.add("tool-bar"),this.items=[],this.emitter=new t.Emitter,this.subscriptions=new t.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"tool-bar:toggle":()=>this.toggle(),"tool-bar:position-top":()=>this.updatePosition("Top"),"tool-bar:position-right":()=>this.updatePosition("Right"),"tool-bar:position-bottom":()=>this.updatePosition("Bottom"),"tool-bar:position-left":()=>this.updatePosition("Left")}),atom.config.observe("tool-bar.iconSize",t=>{this.updateSize(t)}),atom.config.onDidChange("tool-bar.position",()=>{this.refresh()}),atom.config.onDidChange("tool-bar.visible",({newValue:t})=>{t?this.show():this.hide()}),atom.config.onDidChange("tool-bar.fullWidth",()=>{this.refresh()})),atom.config.get("tool-bar.visible")&&this.show(),this.drawGutter=function(t){let e,o,i;function s(){t.apply(o,e),e=o=i=null}function n(){if(null==t)throw new Error("raf debounced function is already disposed.");e=arguments,o=this,window.cancelAnimationFrame(i),i=window.requestAnimationFrame(s)}return n.dispose=()=>{window.cancelAnimationFrame(i),t=e=o=i=null},n}(this.drawGutter.bind(this)),this.subscriptions.add(this.drawGutter),this.element.addEventListener("scroll",this.drawGutter),window.addEventListener("resize",this.drawGutter)}addItem(t){t.priority=this.calculatePriority(t),atom.inDevMode()&&(t.element.dataset.group=t.group,t.element.dataset.priority=t.priority);let e=this.items.findIndex(e=>e.priority>t.priority);-1===e&&(e=this.items.length);const o=this.items[e];return this.items.splice(e,0,t),this.element.insertBefore(t.element,o?o.element:null),this.drawGutter(),o}removeItem(t){t.destroy(),this.items.splice(this.items.indexOf(t),1),this.drawGutter()}destroy(){this.items.forEach(t=>t.destroy()),this.items=null,this.subscriptions.dispose(),this.subscriptions=null,this.hide(),this.element.removeEventListener("scroll",this.drawGutter),this.element=null,window.removeEventListener("resize",this.drawGutter),this.emitter.emit("did-destroy"),this.emitter.dispose(),this.emitter=null}calculatePriority(t){if(!isNaN(t.priority))return t.priority;const e=this.items.filter(e=>e.group!==t.group).pop();return e&&!isNaN(e.priority)?e.priority+1:50}updateSize(t){this.element.classList.remove("tool-bar-12px","tool-bar-14px","tool-bar-16px","tool-bar-18px","tool-bar-21px","tool-bar-24px","tool-bar-28px","tool-bar-32px"),this.element.classList.add("tool-bar-"+t)}updatePosition(t){this.element.classList.remove("tool-bar-top","tool-bar-right","tool-bar-bottom","tool-bar-left","tool-bar-horizontal","tool-bar-vertical"),this.panel=this.createPanel(t),this.element.classList.add("tool-bar-"+t.toLowerCase()),"Top"===t||"Bottom"===t?this.element.classList.add("tool-bar-horizontal"):this.element.classList.add("tool-bar-vertical"),this.drawGutter(),atom.config.set("tool-bar.position",t)}createPanel(t){const e=atom.config.get("tool-bar.fullWidth");switch(t){case"Top":return e?atom.workspace.addHeaderPanel({item:this.element}):atom.workspace.addTopPanel({item:this.element});case"Right":return atom.workspace.addRightPanel({item:this.element});case"Bottom":return e?atom.workspace.addFooterPanel({item:this.element}):atom.workspace.addBottomPanel({item:this.element});case"Left":return atom.workspace.addLeftPanel({item:this.element,priority:50})}}drawGutter(){if(!exports.useGutter)return;this.element.classList.remove("gutter-top","gutter-bottom");const t=this.element.offsetHeight,e=this.element.scrollHeight,o=e-t;t<e&&(this.element.scrollTop>0&&this.element.classList.add("gutter-top"),this.element.scrollTop<o&&this.element.classList.add("gutter-bottom"))}hide(){null!=this.panel&&(this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.panel.destroy(),this.panel=null)}show(){this.hide(),this.updatePosition(atom.config.get("tool-bar.position")),this.updateSize(atom.config.get("tool-bar.iconSize"))}refresh(){atom.config.get("tool-bar.visible")&&this.show()}toggle(){atom.config.set("tool-bar.visible",!atom.config.get("tool-bar.visible"))}}let a=null,l=null;exports.useGutter=!1;exports.activate=function(){a=new r,async function(){if(atom.config.get("tool-bar.useTouchBar")&&"darwin"===process.platform){let t=await Promise.resolve().then((function(){return require("./touch-bar-manager-604890ab.js")}));l=new t}}(),exports.useGutter=atom.config.get("tool-bar.useGutter")},exports.config={visible:{type:"boolean",default:!0,order:1},iconSize:{type:"string",default:"24px",enum:["12px","14px","16px","18px","21px","24px","28px","32px"],order:2},position:{type:"string",default:"Top",enum:["Top","Right","Bottom","Left"],order:3},fullWidth:{type:"boolean",default:!0,order:4},useTouchBar:{title:"Use TouchBar",description:"Show seven first tool bar buttons in the TouchBar",type:"boolean",default:!0,order:5},useGutter:{title:"Use Gutter Shadow",description:"The gutter shadow indicates that some icons are hidden and scrolling is needed. This is off by default (slows down the loading of Tool-bar).",type:"boolean",default:!1,order:6}},exports.deactivate=function(){var t,e;null===(t=a)||void 0===t||t.destroy(),a=null,null===(e=l)||void 0===e||e.destroy(),l=null},exports.provideToolBar=function(){return t=>new n(t,a,l)};
//# sourceMappingURL=tool-bar.js.map
